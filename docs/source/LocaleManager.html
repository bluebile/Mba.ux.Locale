<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js"><span id='Mba-ux-locale-LocaleManager'>/**
</span> * Componente de Locale para uso em apps Sencha.
 *
 * Para uso deste componente crie um arquivo messages.json.
 * na pasta locale do seu projeto com a seguinte estrutura 
 *
 *
 *  @example
 * 
 * {
 * &quot;usuario&quot;: {
 * 
 *
 * 		&quot;dadosInvalidos&quot;: &quot;Dados inválidos. Por favor verifique os dados digitados e tente novamente&quot;,
 *
 * 		&quot;falhaConexao&quot;: &quot;Não foi possível realizar a autenticação. Tente novamente mais tarde&quot;,
 *
 * 		&quot;falha&quot;:&quot;Falha na autenticação&quot;,
 *
 * 		&quot;login&quot;:&quot;Usuário ou senha inválidos&quot;,
 *
 * 		&quot;naoEncontrado&quot;: &quot;Usuário não cadastrado&quot;
 *
 * 	},
 * 
 * }
 * 
 *      title: MbaLocale.get(&#39;usuario.login&#39;),
*/

Ext.define(&#39;Mba.ux.locale.LocaleManager&#39;, {
<span id='Mba-ux-locale-LocaleManager-property-config'>	  /**
</span>      * Propriedades de configuração
      */
	config: {
		
        
<span id='Mba-ux-locale-LocaleManager-cfg-nomeArquivo'>     /**
</span>     * @cfg {String} nomeArquivo (required)
     * Propriedade que define o nome do arquivos das mensagens.
     */
		nomeArquivo: &#39;messages&#39;,
<span id='Mba-ux-locale-LocaleManager-cfg-nomeArquivo'>    /**
</span>     * @cfg {String} nomeArquivo (required)
     * Propriedade que define o separador do arquivos das mensagens.
     */
		separadorLinguagem: &#39;_&#39;,
<span id='Mba-ux-locale-LocaleManager-cfg-separadorLinguagem'>    /**
</span>     * @cfg {String} separadorLinguagem (required)
     * Propriedade que define o lingua Padrao.
     */		
		linguagemPadrao: &#39;pt-br&#39;,
<span id='Mba-ux-locale-LocaleManager-cfg-linguagemPadrao'>	 /**
</span>     * @cfg {String} linguagemPadrao (required)
     * Propriedade que define o caminho do arquivos das mensagens.
     */
		diretorio: &#39;resources/locale/&#39;,
		
<span id='Mba-ux-locale-LocaleManager-cfg-locale'>     /**
</span>     * @cfg {Object} locale (required)
     * Propriedade private que define o objeto de locale retornado.
     */
		locale: null,
<span id='Mba-ux-locale-LocaleManager-cfg-deviceLanguage'>	/**
</span>     * @cfg {Object} deviceLanguage (required)
     * Propriedade private que define o lingua default para dispositivo.
     */	
		deviceLanguage: null,
		
	},
	
<span id='Mba-ux-locale-LocaleManager-method-constructor'>    /**
</span>     * Construtor do componente.
     * @param {Object} [cfg] Recebe as configurações
     */
	constructor: function(config) {
		this.initConfig(config);
		
		// obtendo a linguagem do dispositivo.
		var language = window.navigator.language || window.navigator.userLanguage || window.navigator.browserLanguage || window.navigator.systemLanguages;
		language &amp;&amp; (language = language.toLowerCase());
		this.setDeviceLanguage(language);
		language = (language &amp;&amp; language != this.getLinguagemPadrao()) ? this.getSeparadorLinguagem() + language: &quot;&quot;;
		language=&quot;&quot;;
		// montando a URL do arquivo de mensagem.
		var url = this.obterPrefixo() + this.getNomeArquivo() + language + &quot;.json&quot;;
		
		// carregando arquivo de mensagem.
		var locale = this.carregarLocaleObject(url);
		if (!locale &amp;&amp; language != &quot;&quot;) {
			// carregando arquivo padrão de mensagem porque não encontrou o arquivo da linguagem especificada.
			url = url.replace(language, &quot;&quot;);
			locale = this.carregarLocaleObject(url);
		}
		
		this.setLocale(locale);
	},
<span id='Mba-ux-locale-LocaleManager-method-carregarLocaleObject'>	 /**
</span>     * Carrega o objeto de locale.
     * @param {String} Url para carregar o arquivo JSON
     */
	carregarLocaleObject: function(url) {
		var response = null;

        try {
            Ext.Ajax.request({
                method: &#39;GET&#39;,
                url: url + &quot;?dc=&quot;+Ext.Date.now(),
                responseType: &#39;text&#39;,
                async: false,
                success: function(xhr) {
                    response =  eval(&quot;(&quot; + xhr.responseText + &quot;)&quot;);
                }
            });
        } catch (e) {
            alert(e.message);
        }

		return response;
	},
<span id='Mba-ux-locale-LocaleManager-method-obterPrefixo'>	 /**
</span>     * Obtem prefixo do arquivo  objeto de locale.
     * @return {String} esteArquivo:
     * @method obterPrefixo
     */	
	obterPrefixo: function() {
		if (this.getDiretorio() != null) {
			return this.getDiretorio();
		}
		
		var name = this.self.getName();
		var esteArquivo = Ext.Loader.getPath(name);
		var caminhos = esteArquivo.split(&#39;/&#39;);
		var nomeArquivo = caminhos[caminhos.length - 1];
		
		return esteArquivo.replace(nomeArquivo, &quot;&quot;);
	},
    
    
<span id='Mba-ux-locale-LocaleManager-method-get'>    /**
</span>     * Retorna a chave dentro do arquivo JSON.
     * @param {String} Key chave o arquivo JSON
     * @param {String} defaultText Texto default caso nao encontre a chave
     */
    get: function(key, defaultText) {
    	var inicialKey = key;
        keys = key.split(&#39;.&#39;);
        var kNum = keys.length;
        var locale = this.getLocale();

        for (var i = 0; i &lt; kNum; i++) {
            key = keys[i];

            if (locale) {
                locale = locale[key];
            }
        }

        return locale || defaultText || inicialKey;
    },
    
    
<span id='Mba-ux-locale-LocaleManager-method-format'>    format: function() {
</span>        var theString = arguments[0];
        for (var i = 1; i &lt; arguments.length; i++) {
            var regEx = new RegExp(&quot;\\{&quot; + (i - 1) + &quot;\\}&quot;, &quot;gm&quot;);
            theString = theString.replace(regEx, arguments[i]);
        }
        
        return theString;
    }

});
</pre>
</body>
</html>
